apiVersion: batch/v1
kind: CronJob
metadata:
  name: des-packer-daily
  labels:
    app: des-packer
spec:
  schedule: "0 1 * * *"
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: des-packer
        spec:
          restartPolicy: Never
          containers:
            - name: des-packer
              image: des-packer:latest
              imagePullPolicy: IfNotPresent
              command:
                - "des-pack"
                - "--input-json"
                - "/data/manifests/to-pack.json"
                - "--output-dir"
                - "/data/output"
                - "--max-shard-size"
                - "1073741824"
                - "--n-bits"
                - "8"
              volumeMounts:
                - name: des-input
                  mountPath: /data/input
                - name: des-manifests
                  mountPath: /data/manifests
                - name: des-output
                  mountPath: /data/output
              resources:
                requests:
                  cpu: "500m"
                  memory: "1Gi"
                  ephemeral-storage: "1Gi"
                limits:
                  memory: "2Gi"
                  ephemeral-storage: "2Gi"
          volumes:
            - name: des-input
              persistentVolumeClaim:
                claimName: des-input-pvc
            - name: des-manifests
              persistentVolumeClaim:
                claimName: des-manifests-pvc
            - name: des-output
              persistentVolumeClaim:
                claimName: des-output-pvc
